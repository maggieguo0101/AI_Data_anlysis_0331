# 品牌服务报告多Agent协同系统

## 项目介绍

本项目是一个基于多Agent协同工作的品牌服务报告系统，旨在通过多个专业子Agent的协同工作，高效地分析商户数据，并生成全面、专业的品牌服务报告。系统由一个主对话Agent（王晓慧）和六个专业子Agent组成，主对话Agent负责任务拆解和子Agent协调，而专业子Agent则各司其职，完成具体数据分析任务。

## 系统架构

系统由以下组件构成：

1. **王晓慧对话Agent**：主对话Agent，负责接收用户指令并调度子Agent完成任务，由DeepSeek R1模型驱动
   
2. **专业子Agent**（由Claude 3.7 Sonnet模型驱动）：
   - **流量分析Agent**：分析商户流量数据
   - **交易分析Agent**：分析商户交易及成交订单数据
   - **经营评分Agent**：分析商户经营评分及金银铜牌数据
   - **评价分析Agent**：分析商户评价数据
   - **优惠码Agent**：分析商户星店长或优惠码数据
   - **供给Agent**：分析商户团单销量、团单核销券数据

## 技术框架

系统框架采用模块化设计，包含以下核心模块：

### 1. 配置管理模块（config_manager.py）

- 负责读取和管理agent_config.json配置文件
- 提供配置单例模式，确保全局配置一致性
- 支持获取Agent配置、工作流配置和上下文共享设置
- 支持配置的动态保存和更新

### 2. Agent管理模块（agent_manager.py）

- 实现基础Agent抽象类及派生的MainAgent和SubAgent类
- 使用工厂模式创建不同类型的Agent
- 提供Agent的生命周期管理（创建、初始化、销毁）
- 支持Agent上下文的维护和管理

### 3. 消息总线模块（message_bus.py）

- 实现Agent间的消息传递机制
- 支持消息的广播和定向传递
- 根据配置的工作流执行任务流程
- 提供消息处理器注册和调用机制

### 4. 模型连接器模块（model_connector.py）

- 封装对不同AI模型的API调用
- 支持DeepSeek R1和Claude 3.7 Sonnet模型
- 使用工厂模式创建不同类型的模型连接器
- 提供统一的模型调用接口

### 5. 系统应用模块（app.py）

- 整合各个模块，提供完整的系统功能
- 实现用户交互界面
- 提供工作流执行和消息处理
- 支持命令行交互模式

## 工作流程

系统支持以下工作流程：

### 标准工作流程

1. 用户向王晓慧提出需求
2. 王晓慧分析需求并调度相应子Agent
3. 子Agent执行专业分析任务
4. 子Agent将分析结果返回给王晓慧
5. 王晓慧整合分析结果并返回给用户

### 定制工作流程

系统还支持针对特定任务的定制化工作流程，如针对经营评分分析的专门流程。配置文件中可以定义多种自定义工作流，系统会根据任务类型选择合适的工作流执行。

## 数据分析能力

本系统能够处理的数据指标包括但不限于：

- **流量数据**：总曝光次数、广告曝光次数、自然曝光次数、商户详情页UV等
- **交易数据**：实付GTV、实付验证GTV、交易订单量、交易用户数、交易新客数、核销券数等
- **经营评分数据**：各省份总门店数、金牌门店数及占比、银牌门店数及占比、铜牌门店数占比、无等级门店数及占比等
- **评价数据**：点评新增评价数、美团新增评价数、点评新增差评数、美团新增差评数等
- **优惠码数据**：扫码验证GTV、扫码GTV占比、扫码动销门店数、职人码相关数据等
- **供给数据**：服务时长、商品名称、商品价格、各月份核销券数据等

## 上下文共享机制

系统实现了Agent间的上下文共享机制，确保信息在不同Agent之间有效传递：

- 支持全局上下文共享配置
- 每个Agent维护自己的对话上下文
- 消息总线负责上下文的传递和同步
- 支持选择性上下文共享，提高系统效率

## 使用方法

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行系统
```bash
python main.py
```

### 自定义配置
```bash
python main.py --config your_config.json
```

用户只需使用自然语言向系统提出数据分析需求，系统会自动处理并返回专业的分析结果。例如：

- "帮我查下1月到3月份，郑远元商户的流量数据。"
- "帮我出下郑远元各城市商户的金银铜牌数据，并添加分析附件"
- "帮我查，郑远元商户整体品牌的金银铜牌数据，并计算下月环比的增长"

## 项目文件说明

- **agent_config.json**：系统配置文件，定义了各个Agent的属性、prompt和工作流程
- **main.py**：系统启动入口文件
- **system/**：系统核心模块目录
  - **__init__.py**：包初始化文件
  - **config_manager.py**：配置管理模块
  - **agent_manager.py**：Agent管理模块
  - **message_bus.py**：消息总线模块
  - **model_connector.py**：模型连接器模块
  - **app.py**：系统应用模块
- **analyze_data.py**：数据分析脚本，用于处理Excel数据文件
- **目标及落地方案.md**：项目目标和实施方案的详细说明

## 开发计划

### 当前阶段
- [x] 完成系统架构设计
- [x] 实现配置管理模块
- [x] 实现Agent管理模块
- [x] 实现消息总线模块
- [x] 实现模型连接器模块框架
- [x] 实现系统应用模块

### 下一阶段
- [ ] 实现与真实AI模型API的集成
- [ ] 完善数据处理和分析功能
- [ ] 开发Web用户界面
- [ ] 增加数据可视化功能
- [ ] 优化Agent协作效率
- [ ] 实现系统监控和日志

## 未来规划

- 增强Agent的自主学习能力
- 扩展更多专业领域的子Agent
- 建立Agent性能评估机制
- 引入知识图谱增强分析能力
- 开发移动端应用
